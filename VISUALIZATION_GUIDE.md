# Visualization Guide for Lollipop Plots

This guide explains how to interpret and customize the lollipop plots generated by this tool.

## Plot Components

### 1. Protein Backbone
- **Appearance**: Horizontal gray line
- **Represents**: The full-length protein from position 1 to the specified length
- **Purpose**: Provides the reference frame for all other elements

### 2. Protein Domains
- **Appearance**: Colored rectangles (default: blue with transparency)
- **Position**: Below the protein backbone
- **Labels**: Domain names appear below each rectangle
- **Examples**: RING domain, DNA binding domain, BRCT domains

### 3. Post-Translational Modifications (PTMs)
- **Appearance**: Shaped markers below the domains
- **Shapes**:
  - **Triangle (‚ñ≤)**: Phosphorylation sites
  - **Diamond (‚óÜ)**: Acetylation sites
  - **Inverted Triangle (‚ñº)**: Methylation sites
  - **Left Triangle (‚óÄ)**: Ubiquitination sites
  - **Circle (‚óè)**: Glycosylation sites
- **Color**: Purple with transparency
- **Purpose**: Shows functional regulatory sites

### 4. Variant Lollipops
- **Stem**: Gray vertical line from backbone to variant position
- **Head**: Colored circle at the variant count height
- **Size**: Circle size represents the number of variants/samples
- **Color**: Based on VEP consequence (see below)

### 5. Variant Labels
- **Appearance**: Text annotations showing variant details
- **Format**: "REFpositionALT" (e.g., "A123G")
- **Applied to**: High-impact variants and hotspots
- **Smart positioning**: Uses repelling algorithm to avoid overlaps

## Color Scheme

### VEP Consequence Colors

#### High Impact (Red #FF0000)
- frameshift_variant
- stop_gained
- stop_lost
- start_lost
- splice_acceptor_variant
- splice_donor_variant

**Meaning**: Severe alterations likely to disrupt protein function

#### Moderate Impact (Orange #FFA500)
- missense_variant
- inframe_deletion
- inframe_insertion

**Meaning**: Changes that may affect protein function

#### Low Impact (Green #00AA00)
- synonymous_variant

**Meaning**: Changes that don't alter amino acid sequence

#### Modifier (Light Blue/Aqua)
- intron_variant
- 5_prime_UTR_variant
- 3_prime_UTR_variant

**Meaning**: Changes outside coding regions

## Reading the Plot

### Identifying Key Features

1. **Variant Hotspots**
   - Look for positions with large circles (multiple variants)
   - Multiple variants at one position suggest functional importance

2. **Domain Variants**
   - Variants within domain regions may disrupt domain function
   - Critical if they're high-impact variants (red)

3. **PTM Sites**
   - Variants near PTM sites may affect regulation
   - Check if variants overlap with PTM positions

4. **Distribution Patterns**
   - Clustered variants may indicate a functional region
   - Even distribution suggests random variation

### Example Interpretations

#### Pattern 1: Multiple High-Impact Variants in a Domain
```
[====RING domain====]
     ‚Üì  ‚Üì  ‚Üì
    üî¥ üî¥ üî¥  (red lollipops)
```
**Interpretation**: This domain is a hotspot for pathogenic variants

#### Pattern 2: Variant at PTM Site
```
    ----protein backbone----
         ‚ñ≤ (PTM)
         üî¥ (variant)
```
**Interpretation**: Variant may disrupt post-translational regulation

#### Pattern 3: Large Lollipop (Multiple Samples)
```
         üî¥  (large circle)
         |
    ----protein backbone----
```
**Interpretation**: Recurrent variant across multiple families/samples

## Customization Options

### Adjusting Plot Size

For different purposes:

```r
# For presentations
width = 20, height = 12

# For papers (landscape)
width = 16, height = 10

# For papers (portrait)
width = 10, height = 14

# For quick review
width = 12, height = 8
```

### Filtering Data

Filter before plotting to focus on specific features:

```r
# Only show high-impact variants
high_impact <- variants %>%
  filter(vepIMPACT %in% c("HIGH", "MODERATE"))

# Only show rare variants
rare <- variants %>%
  filter(vepMAX_AF < 0.001)

# Only show specific consequences
missense <- variants %>%
  filter(vepConsequence == "missense_variant")
```

### Modifying Colors

Edit the `consequence_colors` vector in `detailed_lollipop_plot.R`:

```r
consequence_colors <- c(
  "frameshift_variant" = "#FF0000",  # Red
  "missense_variant" = "#FFA500",    # Orange
  "synonymous_variant" = "#00FF00",  # Green
  # Add or modify as needed
)
```

### Adjusting Label Thresholds

Control which variants get labeled:

```r
# In the script, modify this section:
high_impact_variants <- variant_counts %>%
  filter(count > 2 |  # Label if count > 2 (instead of > 1)
         vepConsequence %in% c("frameshift_variant", "stop_gained"))
```

### Changing Point Sizes

Adjust the size range:

```r
# In the script, modify:
scale_size_continuous(range = c(3, 10))  # Default
scale_size_continuous(range = c(2, 8))   # Smaller
scale_size_continuous(range = c(5, 15))  # Larger
```

## Creating Publication-Quality Figures

### Resolution and Format

```r
# High resolution PNG
ggsave("plot.png", width = 16, height = 10, dpi = 300)

# PDF for publication
ggsave("plot.pdf", width = 16, height = 10)

# TIFF for some journals
ggsave("plot.tiff", width = 16, height = 10, dpi = 300, compression = "lzw")
```

### Multi-Panel Figures

Create multiple plots and combine them:

```r
# Create individual plots
plot1 <- create_detailed_lollipop_plot(...)
plot2 <- create_detailed_lollipop_plot(...)

# Use cowplot or patchwork to combine
library(cowplot)
combined <- plot_grid(plot1, plot2, labels = c("A", "B"), ncol = 1)
ggsave("combined_figure.png", combined, width = 16, height = 20, dpi = 300)
```

## Tips for Effective Visualizations

### 1. Choose the Right Scale
- For whole gene: show full length
- For specific region: focus on domain of interest
- Adjust x-axis limits if needed

### 2. Manage Label Density
- Too many labels ‚Üí increase `max.overlaps` or filter variants
- Too few labels ‚Üí decrease threshold for labeling

### 3. Color Consistency
- Use same color scheme across related plots
- Document your color scheme in figure legends

### 4. Annotate Key Features
- Add arrows or boxes for specific variants of interest
- Highlight clinically relevant variants

### 5. Include Scale Information
- Always show protein length
- Include amino acid position scale
- Note if positions are genomic vs. protein coordinates

## Common Use Cases

### Case 1: Comparing Multiple Genes
Create standardized plots for comparison:
```r
genes <- list(
  list(name = "BRCA1", length = 1863),
  list(name = "BRCA2", length = 3418)
)

for (gene in genes) {
  create_detailed_lollipop_plot(
    variant_data = variants,
    gene_name = gene$name,
    protein_length = gene$length,
    width = 16,
    height = 10  # Same size for all
  )
}
```

### Case 2: Before/After Filtering
Show impact of filtering:
```r
# All variants
plot_all <- create_detailed_lollipop_plot(
  variant_data = all_variants,
  gene_name = "BRCA1",
  protein_length = 1863,
  output_file = "all_variants.png"
)

# Filtered variants
plot_filtered <- create_detailed_lollipop_plot(
  variant_data = high_impact_variants,
  gene_name = "BRCA1",
  protein_length = 1863,
  output_file = "filtered_variants.png"
)
```

### Case 3: Region-Specific Analysis
Focus on domains of interest:
```r
# Extract specific region
region_variants <- variants %>%
  filter(POS >= 1650 & POS <= 1855)

# Plot with appropriate title
plot <- create_detailed_lollipop_plot(...)
plot <- plot + labs(subtitle = "BRCT domain region (1650-1855 aa)")
```

## Troubleshooting Visual Issues

### Problem: Overlapping Labels
**Solutions**:
1. Increase `max.overlaps` in `geom_text_repel()`
2. Filter to fewer variants
3. Increase plot width
4. Adjust `box.padding` and `point.padding`

### Problem: Points Too Small/Large
**Solutions**:
1. Adjust `scale_size_continuous(range = c(min, max))`
2. Change base size in `geom_point()`
3. Filter data to focus on specific count ranges

### Problem: Colors Not Visible
**Solutions**:
1. Increase alpha value (transparency)
2. Choose more contrasting colors
3. Use darker background theme

### Problem: Domains Not Visible
**Solutions**:
1. Verify domain data gene names match exactly
2. Check domain coordinates are within protein length
3. Adjust domain rectangle height
4. Change domain colors for better contrast

## Exporting for Different Media

### For Presentations (PowerPoint/Keynote)
- Format: PNG
- Size: 16x10 inches
- DPI: 150-200 (good quality, smaller file)
- High contrast colors

### For Publications (Journals)
- Format: PDF or TIFF
- Size: As specified by journal
- DPI: 300-600
- Follow journal color guidelines

### For Web/Online
- Format: PNG
- Size: 12x8 inches
- DPI: 96-150
- Optimize file size

### For Posters
- Format: PDF
- Size: 20x14 inches or larger
- DPI: 300
- Large fonts and markers

## Advanced Customization

### Adding Custom Annotations
```r
plot <- create_detailed_lollipop_plot(...) +
  annotate("text", x = 500, y = 5, 
           label = "Known pathogenic variant", 
           color = "red", size = 4) +
  annotate("rect", xmin = 450, xmax = 550, 
           ymin = -0.5, ymax = 6,
           fill = NA, color = "red", linetype = "dashed")
```

### Changing Theme
```r
plot <- create_detailed_lollipop_plot(...) +
  theme_bw() +  # or theme_classic(), theme_minimal()
  theme(
    plot.background = element_rect(fill = "white"),
    panel.background = element_rect(fill = "white")
  )
```

### Adding Gridlines
```r
plot <- plot +
  theme(panel.grid.major.x = element_line(color = "gray90"))
```

This guide should help you create effective, informative lollipop plots for your genomic variant data!
